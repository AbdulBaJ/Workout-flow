<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Journey Workout</title>

    <!-- Google Font: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .tab-active {
            border-bottom-color: #2563eb;
            color: #2563eb;
        }

        .tab-inactive {
            border-bottom-color: transparent;
            color: #64748b;
        }

        .tab-inactive:hover {
            color: #334155;
        }

        /* CrossFit Theme Colors for Tab */
        .tab-active-crossfit {
            border-bottom-color: #ef4444;
            color: #ef4444;
        }

        /* Checkbox animation */
        .check-anim {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .check-anim:active {
            transform: scale(0.95);
        }

        /* Counter button styles */
        .counter-btn {
            transition: all 0.15s ease;
            user-select: none;
        }

        .counter-btn:hover {
            transform: scale(1.1);
        }

        .counter-btn:active {
            transform: scale(0.95);
        }

        /* BMI result colors */
        .bmi-underweight {
            background: linear-gradient(135deg, #60a5fa, #3b82f6);
        }

        .bmi-normal {
            background: linear-gradient(135deg, #34d399, #10b981);
        }

        .bmi-overweight {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
        }

        .bmi-obese {
            background: linear-gradient(135deg, #f87171, #ef4444);
        }

        /* Dark mode styles */
        .dark {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border-color: #334155;
        }

        .dark body,
        body.dark {
            background-color: #0f172a;
            color: #f1f5f9;
        }

        .dark .bg-slate-50 {
            background-color: #0f172a;
        }

        .dark .bg-white {
            background-color: #1e293b;
        }

        .dark .bg-slate-100 {
            background-color: #1e293b;
        }

        .dark .bg-slate-50\/50 {
            background-color: rgba(30, 41, 59, 0.5);
        }

        .dark .border-slate-200 {
            border-color: #334155;
        }

        .dark .border-slate-100 {
            border-color: #334155;
        }

        .dark .border-slate-300 {
            border-color: #475569;
        }

        .dark .text-slate-800 {
            color: #f1f5f9;
        }

        .dark .text-slate-700 {
            color: #e2e8f0;
        }

        .dark .text-slate-600 {
            color: #cbd5e1;
        }

        .dark .text-slate-500 {
            color: #94a3b8;
        }

        .dark .text-slate-400 {
            color: #64748b;
        }

        .dark .hover\:bg-slate-50:hover {
            background-color: #334155;
        }

        .dark .bg-slate-200 {
            background-color: #334155;
        }

        .dark .hover\:bg-slate-300:hover {
            background-color: #475569;
        }

        /* Dark mode for specific components */
        .dark .bg-blue-50 {
            background-color: rgba(59, 130, 246, 0.1);
        }

        .dark .bg-emerald-50 {
            background-color: rgba(16, 185, 129, 0.1);
        }

        .dark .bg-red-50 {
            background-color: rgba(239, 68, 68, 0.1);
        }

        .dark .bg-orange-50 {
            background-color: rgba(249, 115, 22, 0.1);
        }

        .dark .bg-orange-100 {
            background-color: rgba(249, 115, 22, 0.15);
        }

        .dark .border-blue-100 {
            border-color: rgba(59, 130, 246, 0.3);
        }

        .dark .border-emerald-100 {
            border-color: rgba(16, 185, 129, 0.3);
        }

        .dark .border-red-200 {
            border-color: rgba(239, 68, 68, 0.3);
        }

        .dark .border-orange-200 {
            border-color: rgba(249, 115, 22, 0.3);
        }

        /* Dark mode toggle button */
        .theme-toggle {
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            transform: rotate(15deg);
        }
    </style>
</head>

<body class="bg-slate-50 min-h-screen pb-20">

    <!-- Header -->
    <div class="bg-slate-900 text-white p-6 shadow-lg">
        <div class="max-w-3xl mx-auto">
            <div class="flex justify-between items-start">
                <div>
                    <h1 class="text-2xl font-bold flex items-center gap-3">
                        <i data-lucide="activity" class="inline-block w-6 h-6 text-blue-400 mr-2"></i>
                        Journey Workout
                    </h1>
                    <p class="text-slate-400 mt-2 text-sm" id="header-subtitle">
                        Weekly Plan • Scale check-in Thursday
                    </p>
                </div>
                <button onclick="toggleDarkMode()"
                    class="theme-toggle p-2 rounded-full bg-slate-800 hover:bg-slate-700 transition-colors"
                    title="Toggle Dark/Light Mode">
                    <i data-lucide="sun" id="theme-icon-sun" class="w-5 h-5 text-yellow-400 hidden"></i>
                    <i data-lucide="moon" id="theme-icon-moon" class="w-5 h-5 text-slate-400"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="sticky top-0 bg-white border-b border-slate-200 z-10 shadow-sm overflow-x-auto">
        <div class="max-w-3xl mx-auto flex">
            <button onclick="openWorkoutSelector()" id="tab-workouts"
                class="flex-1 py-4 px-2 text-sm font-bold border-b-2 transition-colors whitespace-nowrap tab-active">
                <span id="tab-workout-label">Dumbbell Full Body</span> <i data-lucide="chevron-down"
                    class="w-3 h-3 inline ml-1"></i>
            </button>
            <button onclick="renderTab('schedule')" id="tab-schedule"
                class="flex-1 py-4 px-2 text-sm font-bold border-b-2 transition-colors whitespace-nowrap tab-inactive">
                Weekly Schedule
            </button>
            <button onclick="renderTab('bmi')" id="tab-bmi"
                class="flex-1 py-4 px-2 text-sm font-bold border-b-2 transition-colors whitespace-nowrap tab-inactive">
                Weight Calculator
            </button>
        </div>
    </div>

    <!-- Content Area -->
    <div id="app-content" class="max-w-3xl mx-auto p-4 pt-6">
        <!-- Content injected via JS -->
    </div>

    <!-- Workout Selector Modal -->
    <div id="workout-selector-modal"
        class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4 fade-in">
        <div class="bg-white rounded-2xl w-full max-w-sm overflow-hidden shadow-2xl transform transition-all scale-100">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-slate-800">Select Workout</h3>
                    <button onclick="closeWorkoutSelector()" class="text-slate-400 hover:text-slate-600">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>

                <div class="space-y-4">
                    <button onclick="selectWorkout('workoutA')"
                        class="w-full bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-xl p-4 text-left group transition-all">
                        <div class="flex justify-between items-center">
                            <div>
                                <h4 class="font-bold text-blue-900 group-hover:text-blue-700">Full Body A</h4>
                                <p class="text-sm text-blue-600/80">Squats, Presses, Rows</p>
                            </div>
                            <i data-lucide="arrow-right"
                                class="w-5 h-5 text-blue-300 group-hover:text-blue-600 transition-colors"></i>
                        </div>
                    </button>

                    <button onclick="selectWorkout('workoutB')"
                        class="w-full bg-emerald-50 hover:bg-emerald-100 border border-emerald-200 rounded-xl p-4 text-left group transition-all">
                        <div class="flex justify-between items-center">
                            <div>
                                <h4 class="font-bold text-emerald-900 group-hover:text-emerald-700">Full Body B</h4>
                                <p class="text-sm text-emerald-600/80">Lunges, Chest Press, Arms</p>
                            </div>
                            <i data-lucide="arrow-right"
                                class="w-5 h-5 text-emerald-300 group-hover:text-emerald-600 transition-colors"></i>
                        </div>
                    </button>

                    <!-- NEW CROSSFIT SECTION -->
                    <button onclick="selectWorkout('crossfit')"
                        class="w-full bg-red-50 hover:bg-red-100 border border-red-200 rounded-xl p-4 text-left group transition-all">
                        <div class="flex justify-between items-center">
                            <div>
                                <h4 class="font-bold text-red-900 group-hover:text-red-700">CrossFit WOD</h4>
                                <p class="text-sm text-red-600/80">Thrusters, Burpees, High Intensity</p>
                            </div>
                            <i data-lucide="flame"
                                class="w-5 h-5 text-red-300 group-hover:text-red-600 transition-colors"></i>
                        </div>
                    </button>
                </div>
            </div>
            <div class="bg-slate-50 p-4 border-t border-slate-100 text-center">
                <p class="text-xs text-slate-500">Choose your routine for today</p>
            </div>
        </div>
    </div>

    <script>
        // --- STATE MANAGEMENT ---
        const STORAGE_KEY = 'journey_workout_progress';
        const EXERCISE_SETTINGS_KEY = 'journey_exercise_settings';
        const WEEK_START_KEY = 'journey_week_start';
        const BMI_DATA_KEY = 'journey_bmi_data';
        const WEIGHT_HISTORY_KEY = 'journey_weight_history';
        const WARMUP_VISIBLE_KEY = 'journey_warmup_visible';
        const DARK_MODE_KEY = 'journey_dark_mode';
        const SCALE_DAY_KEY = 'journey_scale_day';
        const LAST_TAB_KEY = 'journey_last_tab'; // Store which workout was last open

        const DAYS_OF_WEEK = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

        // Warm-up exercises data
        const warmupExercises = [
            {
                name: "Arm Circles",
                duration: "30-60 sec",
                image: "Arm Circles.webp",
                instructions: "Start with small forward arm circles, gradually increasing size for 15-30 seconds, then reverse. Follow with cross-body arm swings to loosen the chest and shoulders."
            },
            {
                name: "Leg Swings",
                duration: "30 sec each leg",
                image: "Leg Swings.webp",
                instructions: "Swing one leg forward and back, then side to side, holding onto a wall for balance if needed. Do 10-15 swings in each direction per leg."
            },
            {
                name: "Torso Twists",
                duration: "30 sec",
                image: "Torse Twists.webp",
                instructions: "Stand tall with feet shoulder width apart. Twist from side to side by rotating your upper body from the hips, bringing the head around and pivoting on the feet."
            }
        ];

        function getProgress() {
            const stored = localStorage.getItem(STORAGE_KEY);
            return stored ? JSON.parse(stored) : {};
        }

        function saveProgress(progress) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(progress));
        }

        function getExerciseSettings() {
            const stored = localStorage.getItem(EXERCISE_SETTINGS_KEY);
            return stored ? JSON.parse(stored) : {};
        }

        function saveExerciseSettings(settings) {
            localStorage.setItem(EXERCISE_SETTINGS_KEY, JSON.stringify(settings));
        }

        function getWeekStart() {
            return localStorage.getItem(WEEK_START_KEY) || 'Sunday';
        }

        function setWeekStart(day) {
            localStorage.setItem(WEEK_START_KEY, day);
            updateHeaderSubtitle();
        }

        // Scale day functions
        function getScaleDay() {
            return localStorage.getItem(SCALE_DAY_KEY) || 'Thursday';
        }

        function setScaleDay(day) {
            localStorage.setItem(SCALE_DAY_KEY, day);
            updateHeaderSubtitle();
        }

        // Dark mode functions
        function getDarkMode() {
            return localStorage.getItem(DARK_MODE_KEY) === 'true';
        }

        function setDarkMode(enabled) {
            localStorage.setItem(DARK_MODE_KEY, enabled);
        }

        function toggleDarkMode() {
            const isDark = getDarkMode();
            setDarkMode(!isDark);
            applyDarkMode(!isDark);
        }

        function applyDarkMode(isDark) {
            if (isDark) {
                document.documentElement.classList.add('dark');
                document.body.classList.add('dark');
                document.getElementById('theme-icon-sun').classList.remove('hidden');
                document.getElementById('theme-icon-moon').classList.add('hidden');
            } else {
                document.documentElement.classList.remove('dark');
                document.body.classList.remove('dark');
                document.getElementById('theme-icon-sun').classList.add('hidden');
                document.getElementById('theme-icon-moon').classList.remove('hidden');
            }
            lucide.createIcons();
        }

        function updateHeaderSubtitle() {
            const startDay = getWeekStart();
            const endDayIndex = (DAYS_OF_WEEK.indexOf(startDay) + 6) % 7;
            const endDay = DAYS_OF_WEEK[endDayIndex];
            const scaleDay = getScaleDay();
            document.getElementById('header-subtitle').textContent =
                `Weekly Plan • ${startDay} to ${endDay} • Scale check-in ${scaleDay}`;
        }

        function getBMIData() {
            const stored = localStorage.getItem(BMI_DATA_KEY);
            return stored ? JSON.parse(stored) : { height: '', weight: '', unit: 'metric' };
        }

        function saveBMIData(data) {
            localStorage.setItem(BMI_DATA_KEY, JSON.stringify(data));
        }

        // Weight history functions
        function getWeightHistory() {
            const stored = localStorage.getItem(WEIGHT_HISTORY_KEY);
            return stored ? JSON.parse(stored) : [];
        }

        function saveWeightHistory(history) {
            localStorage.setItem(WEIGHT_HISTORY_KEY, JSON.stringify(history));
        }

        function addWeightEntry(weight) {
            const history = getWeightHistory();
            const today = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
            history.unshift({ date: today, weight: weight });
            // Keep only last 20 entries
            if (history.length > 20) history.pop();
            saveWeightHistory(history);
        }

        function deleteWeightEntry(index) {
            const history = getWeightHistory();
            history.splice(index, 1);
            saveWeightHistory(history);
            renderTab('bmi');
        }

        // Warm-up toggle
        function getWarmupVisible(workoutType) {
            const stored = localStorage.getItem(WARMUP_VISIBLE_KEY);
            const data = stored ? JSON.parse(stored) : {};
            return data[workoutType] || false;
        }

        function toggleWarmup(workoutType) {
            const stored = localStorage.getItem(WARMUP_VISIBLE_KEY);
            const data = stored ? JSON.parse(stored) : {};
            data[workoutType] = !data[workoutType];
            localStorage.setItem(WARMUP_VISIBLE_KEY, JSON.stringify(data));
            renderTab(workoutType);
        }

        // Helper function to get dynamic workout days based on week start
        function getDynamicWorkoutDays() {
            const startDay = getWeekStart();
            const startIndex = DAYS_OF_WEEK.indexOf(startDay);

            // Original pattern: Day 0=Full Body A, Day 1=Full Body B, Day 2=Rest, Day 3=Full Body A, Day 4=Full Body B+Scale, Day 5=Cardio, Day 6=Rest
            const workoutADay1 = DAYS_OF_WEEK[startIndex];
            const workoutBDay1 = DAYS_OF_WEEK[(startIndex + 1) % 7];
            const workoutADay2 = DAYS_OF_WEEK[(startIndex + 3) % 7];
            const workoutBDay2 = DAYS_OF_WEEK[(startIndex + 4) % 7];

            return {
                workoutA: [workoutADay1, workoutADay2],
                workoutB: [workoutBDay1, workoutBDay2],
                scaleDay: workoutBDay2
            };
        }

        function toggleExercise(name) {
            const progress = getProgress();
            progress[name] = !progress[name];
            saveProgress(progress);

            // Re-render to update UI
            // We need to know which tab is active to re-render correctly
            const currentTab = localStorage.getItem(LAST_TAB_KEY) || 'workoutA';
            renderTab(currentTab);
        }

        function adjustExerciseSetting(exerciseName, field, delta) {
            const settings = getExerciseSettings();
            if (!settings[exerciseName]) {
                settings[exerciseName] = {};
            }

            // Get current value or default
            const allExercises = [...workoutA, ...workoutB, ...workoutCrossFit];
            const exercise = allExercises.find(e => e.name === exerciseName);

            // Handle "Rounds" for CrossFit
            let defaultValue = 3;
            if (exercise.sets.toLowerCase().includes('round')) {
                defaultValue = parseInt(exercise.sets) || 3;
            } else {
                defaultValue = parseInt(exercise.sets) || 3;
            }

            const currentValue = settings[exerciseName][field] !== undefined
                ? settings[exerciseName][field]
                : defaultValue;

            const newValue = Math.max(1, currentValue + delta);
            settings[exerciseName][field] = newValue;
            saveExerciseSettings(settings);

            // Re-render
            const currentTab = localStorage.getItem(LAST_TAB_KEY) || 'workoutA';
            renderTab(currentTab);
        }

        function resetExerciseSettings(exerciseName) {
            const settings = getExerciseSettings();
            delete settings[exerciseName];
            saveExerciseSettings(settings);

            const currentTab = localStorage.getItem(LAST_TAB_KEY) || 'workoutA';
            renderTab(currentTab);
        }

        function resetDay() {
            if (confirm("Are you sure you want to finish and reset for the next day?")) {
                localStorage.removeItem(STORAGE_KEY);
                const currentTab = localStorage.getItem(LAST_TAB_KEY) || 'workoutA';
                renderTab(currentTab);
            }
        }

        // --- DATA ---
        const workoutA = [
            {
                name: "Goblet Squat",
                sets: "3",
                reps: "12",
                muscles: "Quads, Glutes, Core",
                image: "Goblet Squat.webp",
                instructions: [
                    "Hold one dumbbell vertically against your chest with both hands cupping the top end.",
                    "Stand with feet slightly wider than shoulder-width.",
                    "Lower your hips back and down as if sitting in a low chair.",
                    "Keep your chest up and elbows inside your knees at the bottom.",
                    "Drive back up through your heels."
                ]
            },
            {
                name: "Dumbbell Shoulder Press",
                sets: "3",
                reps: "10",
                muscles: "Shoulders, Triceps",
                image: "Dumbbell Shoulder Press.webp",
                instructions: [
                    "Stand or sit holding dumbbells at shoulder height, palms facing forward.",
                    "Press the weights straight up until arms are fully extended.",
                    "Lower them back down slowly to the starting position.",
                    "Keep your core tight to avoid arching your back."
                ]
            },
            {
                name: "Dumbbell Bent-Over Row",
                sets: "3",
                reps: "12",
                muscles: "Back (Lats), Biceps",
                image: "Dumbbell Bent-Over Row.webp",
                instructions: [
                    "Hold a dumbbell in each hand.",
                    "Hinge at your hips until your torso is almost parallel to the floor.",
                    "Keep your back flat, not rounded.",
                    "Pull the weights towards your hips, squeezing your shoulder blades together.",
                    "Lower slowly."
                ]
            },
            {
                name: "Dumbbell Romanian Deadlift",
                sets: "3",
                reps: "12",
                muscles: "Hamstrings, Glutes, Lower Back",
                image: "Dumbbell Romanian Deadlift.webp",
                instructions: [
                    "Stand with dumbbells hanging in front of your thighs.",
                    "Keep a slight bend in your knees (don't lock them).",
                    "Push your hips WAY back while lowering the weights toward your shins.",
                    "Stop when you feel a stretch in your hamstrings.",
                    "Squeeze your glutes to stand back up."
                ]
            },
            {
                name: "Plank",
                sets: "3",
                reps: "30-45 sec",
                muscles: "Core, Abs",
                image: "Plank.webp",
                instructions: [
                    "Get into a push-up position but rest on your forearms.",
                    "Your body should form a straight line from head to heels.",
                    "Squeeze your glutes and pull your belly button to your spine.",
                    "Hold without letting your hips sag or hike up."
                ]
            }
        ];

        const workoutB = [
            {
                name: "Reverse Lunges",
                sets: "3",
                reps: "10 each",
                muscles: "Quads, Glutes",
                image: "Reverse Lunges.webp",
                instructions: [
                    "Stand tall with dumbbells in hands by your sides.",
                    "Step one foot back and lower your back knee toward the ground.",
                    "Both knees should bend to about 90 degrees.",
                    "Push through your front heel to return to standing.",
                    "Alternate legs or do all reps on one side then switch."
                ]
            },
            {
                name: "Dumbbell Chest Press (Floor)",
                sets: "3",
                reps: "10",
                muscles: "Chest, Triceps, Front Shoulders",
                image: "Dumbbell Chest Press (Floor).webp",
                instructions: [
                    "Lie flat on the floor with knees bent and feet flat.",
                    "Hold dumbbells above your chest with arms straight.",
                    "Lower the weights until your triceps (back of arm) gently touch the floor.",
                    "Press back up to the start.",
                    "Keep your elbows at a 45-degree angle from your body."
                ]
            },
            {
                name: "Dumbbell Lateral Raise",
                sets: "3",
                reps: "12",
                muscles: "Side Shoulders",
                image: "Dumbbell Lateral Raise.webp",
                instructions: [
                    "Stand holding dumbbells at your sides.",
                    "Raise your arms out to the sides until they reach shoulder height.",
                    "Keep a slight bend in your elbows.",
                    "Lower slowly back to your sides."
                ]
            },
            {
                name: "Dumbbell Biceps Curl",
                sets: "3",
                reps: "12",
                muscles: "Biceps",
                image: "Dumbbell Biceps Curl.webp",
                instructions: [
                    "Hold dumbbells with palms facing forward.",
                    "Keep elbows glued to your sides.",
                    "Curl the weights up towards your shoulders.",
                    "Squeeze at the top and lower slowly."
                ]
            },
            {
                name: "Dumbbell Triceps Extension",
                sets: "3",
                reps: "12",
                muscles: "Triceps",
                image: "Dumbbell Triceps Extension.webp",
                instructions: [
                    "Can be done standing or lying down (skullcrushers).",
                    "Hold one dumbbell with both hands overhead (or two lighter ones).",
                    "Bend your elbows to lower the weight behind your head.",
                    "Keep your upper arms still and close to your head.",
                    "Extend arms back up to the ceiling."
                ]
            }
        ];

        // --- CROSSFIT DATA ---
        const workoutCrossFit = [
            {
                name: "Dumbbell Thrusters",
                sets: "3 Rounds",
                reps: "15",
                muscles: "Full Body, Cardio",
                image: "Dumbbell Thrusters.webp",
                instructions: [
                    "Hold dumbbells at shoulder height, palms facing in.",
                    "Perform a full squat, keeping chest up.",
                    "As you stand up explosively, use the momentum to press the dumbbells overhead.",
                    "Lower weights back to shoulders and immediately descend into the next squat.",
                    "This is one fluid motion."
                ]
            },
            {
                name: "Burpees",
                sets: "3 Rounds",
                reps: "10",
                muscles: "Full Body, Cardio",
                image: "Burpees.webp",
                instructions: [
                    "Start standing, then squat down and place hands on floor.",
                    "Jump feet back into a push-up position.",
                    "Lower chest to floor, then push up.",
                    "Jump feet back to hands.",
                    "Jump explosively into the air, clapping hands overhead."
                ]
            },
            {
                name: "Kettlebell/DB Swings",
                sets: "3 Rounds",
                reps: "20",
                muscles: "Hips, Glutes, Hamstrings",
                image: "Kettlebell DB Swings.webp",
                instructions: [
                    "Stand with feet wider than shoulder-width, holding weight with both hands.",
                    "Hinge at hips, hiking the weight back between legs.",
                    "Explosively snap hips forward to swing weight up to chest height.",
                    "Control the swing back down between legs.",
                    "Use your hips, not your arms, to move the weight."
                ]
            },
            {
                name: "Alternating Jump Lunges",
                sets: "3 Rounds",
                reps: "20 (Total)",
                muscles: "Legs, Glutes, Cardio",
                image: "Alternating Jump Lunges.webp",
                instructions: [
                    "Start in a lunge position with knees at 90 degrees.",
                    "Jump explosively into the air, switching legs mid-air.",
                    "Land softly in a lunge with the opposite leg forward.",
                    "Keep your chest up and core tight throughout.",
                    "If too difficult, perform alternating reverse lunges quickly."
                ]
            },
            {
                name: "Butterfly Sit-ups",
                sets: "3 Rounds",
                reps: "20",
                muscles: "Abs, Core",
                image: "Butterfly Sit-ups.webp",
                instructions: [
                    "Sit with soles of feet together, knees out (butterfly position).",
                    "Lie back until hands touch floor behind head.",
                    "Sit all the way up until hands touch floor in front of toes.",
                    "Keep the motion fluid."
                ]
            }
        ];

        // Schedule patterns (position-based, not day-based)
        const schedulePatterns = [
            { position: 0, title: "Full Body A", routine: [{ type: 'exercise', text: 'Start Day! Main Workout A' }, { type: 'cardio', text: 'Walk 10-20 min' }] },
            { position: 1, title: "Full Body B", routine: [{ type: 'exercise', text: 'Main Workout B' }, { type: 'cardio', text: 'Walk 10-20 min' }] },
            { position: 2, title: "Active Recovery", isRest: true, routine: [{ type: 'cardio', text: 'Walk 20-30 min' }, { type: 'cardio', text: 'Light Stretching & Breathing' }] },
            { position: 3, title: "Full Body A", routine: [{ type: 'exercise', text: 'Main Workout A' }, { type: 'cardio', text: 'Walk 10-20 min' }] },
            { position: 4, title: "Full Body B + Scale", routine: [{ type: 'exercise', text: 'Scale Check-in (Morning Fasted)' }, { type: 'exercise', text: 'Main Workout B' }, { type: 'cardio', text: 'Walk 10-20 min' }] },
            { position: 5, title: "Cardio & Mobility", isRest: true, routine: [{ type: 'cardio', text: 'Walk 30 min' }, { type: 'cardio', text: 'Mobility Routine 10 min' }] },
            { position: 6, title: "Full Rest", isRest: true, routine: [{ type: 'cardio', text: 'Optional light walk' }] },
        ];

        function getReorderedSchedule() {
            const startDay = getWeekStart();
            const startIndex = DAYS_OF_WEEK.indexOf(startDay);
            const schedule = [];

            for (let i = 0; i < 7; i++) {
                const dayIndex = (startIndex + i) % 7;
                const dayName = DAYS_OF_WEEK[dayIndex];
                const pattern = schedulePatterns[i];
                schedule.push({
                    day: dayName,
                    title: pattern.title,
                    isRest: pattern.isRest || false,
                    routine: pattern.routine
                });
            }
            return schedule;
        }

        // --- MODAL FUNCTIONS ---
        function openWorkoutSelector() {
            document.getElementById('workout-selector-modal').classList.remove('hidden');
        }

        function closeWorkoutSelector() {
            document.getElementById('workout-selector-modal').classList.add('hidden');
        }

        function selectWorkout(type) {
            renderTab(type);
            closeWorkoutSelector();
        }

        // Close modal when clicking outside
        document.getElementById('workout-selector-modal').addEventListener('click', function (e) {
            if (e.target === this) {
                closeWorkoutSelector();
            }
        });

        // --- RENDER FUNCTIONS ---

        function renderExerciseCard(ex) {
            const progress = getProgress();
            const settings = getExerciseSettings();
            const isCompleted = progress[ex.name] === true;

            // Get current sets/reps (custom or default)
            // Handle "3 Rounds" vs "3" sets logic
            let defaultSets = 3;
            let setsLabel = "Sets";

            if (ex.sets.toString().includes("Round")) {
                defaultSets = parseInt(ex.sets);
                setsLabel = "Rounds";
            } else {
                defaultSets = parseInt(ex.sets) || 3;
            }

            const defaultReps = ex.reps;
            const currentSets = settings[ex.name]?.sets !== undefined ? settings[ex.name].sets : defaultSets;
            const currentReps = settings[ex.name]?.reps !== undefined ? settings[ex.name].reps : (parseInt(defaultReps) || defaultReps);

            const hasCustomSettings = settings[ex.name] && (settings[ex.name].sets !== undefined || settings[ex.name].reps !== undefined);

            const cardClass = isCompleted
                ? "bg-emerald-50 border-emerald-200"
                : "bg-white border-slate-200";

            const headerClass = isCompleted
                ? "bg-emerald-100 border-emerald-200"
                : "bg-slate-50 border-slate-100";

            const btnClass = isCompleted
                ? "bg-emerald-500 hover:bg-emerald-600 text-white"
                : "bg-white hover:bg-slate-50 text-slate-400 border border-slate-300";

            const btnIcon = isCompleted ? "check" : "circle";

            const imageHtml = ex.image ? `
                <div class="w-full h-64 ${isCompleted ? 'bg-emerald-50/50' : 'bg-slate-100'} flex items-center justify-center overflow-hidden border-b ${isCompleted ? 'border-emerald-100' : 'border-slate-100'}">
                    <img src="${ex.image}" alt="${ex.name}" onerror="this.src='https://placehold.co/400x300/e2e8f0/64748b?text=${ex.name.replace(/ /g, '+')}'" class="w-full h-full object-contain p-2">
                </div>
            ` : '';

            const instructionsHtml = ex.instructions.map(step => `
                <li class="flex items-start gap-2 text-slate-700 text-sm">
                    <span class="mt-1 min-w-[6px] h-[6px] rounded-full bg-blue-400 block"></span>
                    ${step}
                </li>
            `).join('');

            // Check if reps is a number (can be adjusted) or text like "30-45 sec"
            const isRepsNumeric = !isNaN(parseInt(ex.reps)) && !ex.reps.includes('sec') && !ex.reps.includes('each');
            const displayReps = isRepsNumeric ? currentReps : ex.reps;

            return `
            <div class="${cardClass} rounded-xl shadow-sm border overflow-hidden hover:shadow-md transition-all duration-300 mb-6">
                <div class="${headerClass} p-4 border-b">
                    <div class="flex justify-between items-center mb-3">
                        <div class="flex-1">
                            <h3 class="font-bold text-lg text-slate-800 flex items-center gap-2">
                                <i data-lucide="dumbbell" class="w-5 h-5 text-blue-600"></i>
                                ${ex.name}
                            </h3>
                            <p class="text-slate-500 text-sm mt-1">${ex.muscles}</p>
                        </div>
                        
                        <button onclick="toggleExercise('${ex.name}')" class="${btnClass} w-10 h-10 rounded-full flex items-center justify-center shadow-sm check-anim" title="Mark as Complete">
                            <i data-lucide="${btnIcon}" class="w-6 h-6"></i>
                        </button>
                    </div>
                    
                    <!-- Sets & Reps Controls -->
                    <div class="flex flex-wrap gap-3 items-center">
                        <!-- Sets Control -->
                        <div class="flex items-center gap-2 bg-blue-50 rounded-lg px-3 py-2">
                            <button onclick="adjustExerciseSetting('${ex.name}', 'sets', -1)" class="counter-btn w-7 h-7 rounded-full bg-blue-200 hover:bg-blue-300 text-blue-800 flex items-center justify-center font-bold text-lg">−</button>
                            <div class="text-center min-w-[60px]">
                                <span class="text-blue-800 font-bold text-lg">${currentSets}</span>
                                <span class="text-blue-600 text-sm ml-1">${setsLabel}</span>
                                ${currentSets !== defaultSets ? `<div class="text-xs text-blue-500">(Rec: ${defaultSets})</div>` : ''}
                            </div>
                            <button onclick="adjustExerciseSetting('${ex.name}', 'sets', 1)" class="counter-btn w-7 h-7 rounded-full bg-blue-200 hover:bg-blue-300 text-blue-800 flex items-center justify-center font-bold text-lg">+</button>
                        </div>
                        
                        <!-- Reps Control -->
                        <div class="flex items-center gap-2 bg-emerald-50 rounded-lg px-3 py-2">
                            ${isRepsNumeric ? `
                                <button onclick="adjustExerciseSetting('${ex.name}', 'reps', -1)" class="counter-btn w-7 h-7 rounded-full bg-emerald-200 hover:bg-emerald-300 text-emerald-800 flex items-center justify-center font-bold text-lg">−</button>
                            ` : ''}
                            <div class="text-center min-w-[60px]">
                                <span class="text-emerald-800 font-bold text-lg">${displayReps}</span>
                                <span class="text-emerald-600 text-sm ml-1">Reps</span>
                                ${isRepsNumeric && currentReps !== parseInt(defaultReps) ? `<div class="text-xs text-emerald-500">(Rec: ${defaultReps})</div>` : ''}
                            </div>
                            ${isRepsNumeric ? `
                                <button onclick="adjustExerciseSetting('${ex.name}', 'reps', 1)" class="counter-btn w-7 h-7 rounded-full bg-emerald-200 hover:bg-emerald-300 text-emerald-800 flex items-center justify-center font-bold text-lg">+</button>
                            ` : ''}
                        </div>
                        
                        ${hasCustomSettings ? `
                            <button onclick="resetExerciseSettings('${ex.name}')" class="text-xs text-slate-500 hover:text-slate-700 underline">Reset to default</button>
                        ` : ''}
                    </div>
                </div>
                
                ${imageHtml}
                
                <div class="p-5">
                    <div class="mb-4">
                        <h4 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">How to Perform</h4>
                        <ul class="space-y-2">
                            ${instructionsHtml}
                        </ul>
                    </div>

                    <button 
                        onclick="window.open('https://www.youtube.com/results?search_query=how+to+do+${ex.name.replace(/ /g, '+')}', '_blank')"
                        class="w-full flex items-center justify-center gap-2 bg-slate-800 hover:bg-slate-700 text-white py-2 rounded-lg text-sm font-medium transition-colors cursor-pointer"
                    >
                        <i data-lucide="play-circle" class="w-4 h-4"></i>
                        Watch Video Demo
                    </button>
                </div>
            </div>
            `;
        }

        function renderScheduleDay(day) {
            const badgeClass = day.isRest ? 'bg-indigo-100 text-indigo-700' : 'bg-slate-100 text-slate-600';
            const listItems = day.routine.map(item => `
                <li class="text-sm text-slate-600 flex items-center gap-2">
                    ${item.type === 'exercise'
                    ? '<div class="w-1.5 h-1.5 rounded-full bg-blue-500"></div>'
                    : '<i data-lucide="activity" class="w-3 h-3 text-emerald-500"></i>'}
                    ${item.text}
                </li>
            `).join('');

            return `
            <div class="bg-white p-4 rounded-xl border border-slate-200 mb-4">
                <div class="flex items-center justify-between mb-3">
                    <h3 class="font-bold text-slate-800">${day.day}</h3>
                    <span class="text-xs px-2 py-1 rounded-full font-medium ${badgeClass}">
                        ${day.title}
                    </span>
                </div>
                <ul class="space-y-2">
                    ${listItems}
                </ul>
            </div>
            `;
        }

        function renderBMICalculator() {
            const bmiData = getBMIData();
            const weightHistory = getWeightHistory();

            return `
            <div class="fade-in">
                <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                    <i data-lucide="scale" class="w-5 h-5"></i>
                    Weight Calculator
                </h2>
                
                <div class="bg-white rounded-xl border border-slate-200 p-6 mb-6">
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-slate-700 mb-2">Unit System</label>
                        <div class="flex gap-2">
                            <button onclick="toggleBMIUnit('metric')" id="btn-metric" class="flex-1 py-2 px-4 rounded-lg font-medium transition-colors ${bmiData.unit === 'metric' ? 'bg-blue-600 text-white' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}">
                                Metric (kg/cm)
                            </button>
                            <button onclick="toggleBMIUnit('imperial')" id="btn-imperial" class="flex-1 py-2 px-4 rounded-lg font-medium transition-colors ${bmiData.unit === 'imperial' ? 'bg-blue-600 text-white' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}">
                                Imperial (lb/ft)
                            </button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-2">
                                Height ${bmiData.unit === 'metric' ? '(cm)' : '(inches)'}
                            </label>
                            <input 
                                type="number" 
                                id="bmi-height" 
                                value="${bmiData.height}"
                                placeholder="${bmiData.unit === 'metric' ? 'e.g., 175' : 'e.g., 69'}"
                                class="w-full px-4 py-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all text-lg"
                            >
                        </div>
                        <div>
                            <label 
